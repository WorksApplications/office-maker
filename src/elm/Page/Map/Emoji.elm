module Page.Map.Emoji exposing (TextFragment(..), split, view, selector)

import Json.Decode as Decode exposing (Decoder)
import Html exposing (..)
import Html.Attributes exposing (..)
import Html.Events exposing (..)
import Native.Emoji
import Util.ListUtil as ListUtil
import Page.Map.Msg exposing (..)


type alias Json = Decode.Value


splitText : String -> List Json
splitText =
  Native.Emoji.splitText


type TextFragment
  = TextNode String
  | Image String String


decodeFragment : Decoder TextFragment
decodeFragment =
  Decode.field "type" Decode.string
    |> Decode.andThen (\tipe ->
      case tipe of
        "text" ->
          Decode.field "value" Decode.string |> Decode.map TextNode

        "image" ->
          Decode.map2 Image
            (Decode.field "original" Decode.string)
            (Decode.field "url" Decode.string)
            
        _ ->
          Decode.fail ("unknown type" ++ tipe)
    )


split : String -> (List TextFragment)
split s =
  splitText s
    |> List.map (
      Decode.decodeValue decodeFragment
        >> (\result ->
          case result of
            Ok fragment -> fragment
            Err message -> Debug.crash ("bug in Emoji.split: " ++ message)
        )
    )


view : List (Attribute msg) -> String -> Html msg
view attr s =
  split s
    |> List.map (\fragment ->
      case fragment of
        TextNode s ->
          text ""
        Image original url ->
          img
            [ draggable "false"
            , class "emoji"
            , alt original
            , src url
            ]
            []
    )
  |> div []


selector : () -> Html Msg
selector _ =
  all
    |> ListUtil.sepBy 10
    |> List.map (List.map selectorEach >> div [])
    |> div []


selectorEach : String -> Html Msg
selectorEach s =
  view [ onClick (InsertEmoji s) ] s


all : List String
all =
  [ "🚹"
  , "🚺"
  , "🚻"
  , "🚼"
  , "🛀"
  , "🌂"
  , "🍔"
  , "🍕"
  , "🍖"
  , "🍗"
  ] ++
  [ "🍘"
  , "🍙"
  , "🍚"
  , "🍛"
  , "🍜"
  , "🍝"
  , "🍞"
  , "🍩"
  , "🍪"
  , "🍫"
  , "🍬"
  ] ++
  [ "🍭"
  , "🍮"
  , "🍯"
  , "🍰"
  , "👦"
  , "👧"
  , "👨"
  , "👩"
  , "👰"
  , "👱"
  , "👲"
  ] ++
  [ "👳"
  , "👴"
  , "👵"
  , "👶"
  , "👷"
  , "👸"
  , "📞"
  , "📖"
  , "📔"
  , "📕"
  , "📗"
  , "📘"
  ] ++
  [ "📙"
  , "📚"
  , "❓"
  , "❔"
  , "❕"
  , "❗"
  , "❤"
  , "💙"
  , "💚"
  , "💛"
  , "💜"
  ]
--
--
-- others : List String
-- others =
--   [ "🈁"
--   , "🈚"
--   , "🈯"
--   , "🈲"
--   , "🈳"
--   , "🈴"
--   , "🈵"
--   , "🈶"
--   , "🈸"
--   , "🈹"
--   , "🈺"
--   , "🉐"
--   , "🉑"
--   , "🌀"
--   , "🌁"
--   , "🌂"
--   , "🌃"
--   , "🌄"
--   , "🌅"
--   , "🌆"
--   , "🌇"
--   , "🌈"
--   , "🌉"
--   , "🌊"
--   , "🌋"
--   , "🌌"
--   , "🌏"
--   , "🌑"
--   , "🌓"
--   , "🌔"
--   , "🌕"
--   , "🌙"
--   , "🌛"
--   , "🌟"
--   , "🌠"
--   , "🌰"
--   , "🌱"
--   , "🌴"
--   , "🌵"
--   , "🌷"
--   , "🌸"
--   , "🌹"
--   , "🌺"
--   , "🌻"
--   , "🌼"
--   , "🌽"
--   , "🌾"
--   , "🌿"
--   , "🍀"
--   , "🍁"
--   , "🍂"
--   , "🍃"
--   , "🍄"
--   , "🍅"
--   , "🍆"
--   , "🍇"
--   , "🍈"
--   , "🍉"
--   , "🍊"
--   , "🍌"
--   , "🍍"
--   , "🍎"
--   , "🍏"
--   , "🍑"
--   , "🍒"
--   , "🍓"
--   , "🍔"
--   , "🍕"
--   , "🍖"
--   , "🍗"
--   , "🍘"
--   , "🍙"
--   , "🍚"
--   , "🍛"
--   , "🍜"
--   , "🍝"
--   , "🍞"
--   , "🍟"
--   , "🍠"
--   , "🍡"
--   , "🍢"
--   , "🍣"
--   , "🍤"
--   , "🍥"
--   , "🍦"
--   , "🍧"
--   , "🍨"
--   , "🍩"
--   , "🍪"
--   , "🍫"
--   , "🍬"
--   , "🍭"
--   , "🍮"
--   , "🍯"
--   , "🍰"
--   , "🍱"
--   , "🍲"
--   , "🍳"
--   , "🍴"
--   , "🍵"
--   , "🍶"
--   , "🍷"
--   , "🍸"
--   , "🍹"
--   , "🍺"
--   , "🍻"
--   , "🎀"
--   , "🎁"
--   , "🎂"
--   , "🎃"
--   , "🎄"
--   , "🎅"
--   , "🎆"
--   , "🎇"
--   , "🎈"
--   , "🎉"
--   , "🎊"
--   , "🎋"
--   , "🎌"
--   , "🎍"
--   , "🎎"
--   , "🎏"
--   , "🎐"
--   , "🎑"
--   , "🎒"
--   , "🎓"
--   , "🎠"
--   , "🎡"
--   , "🎢"
--   , "🎣"
--   , "🎤"
--   , "🎥"
--   , "🎦"
--   , "🎧"
--   , "🎨"
--   , "🎩"
--   , "🎪"
--   , "🎫"
--   , "🎬"
--   , "🎭"
--   , "🎮"
--   , "🎯"
--   , "🎰"
--   , "🎱"
--   , "🎲"
--   , "🎳"
--   , "🎴"
--   , "🎵"
--   , "🎶"
--   , "🎷"
--   , "🎸"
--   , "🎹"
--   , "🎺"
--   , "🎻"
--   , "🎼"
--   , "🎽"
--   , "🎾"
--   , "🎿"
--   , "🏀"
--   , "🏁"
--   , "🏂"
--   , "🏃"
--   , "🏄"
--   , "🏆"
--   , "🏈"
--   , "🏊"
--   , "🏠"
--   , "🏡"
--   , "🏢"
--   , "🏣"
--   , "🏥"
--   , "🏦"
--   , "🏧"
--   , "🏨"
--   , "🏩"
--   , "🏪"
--   , "🏫"
--   , "🏬"
--   , "🏭"
--   , "🏮"
--   , "🏯"
--   , "🏰"
--   , "🐌"
--   , "🐍"
--   , "🐎"
--   , "🐑"
--   , "🐒"
--   , "🐔"
--   , "🐗"
--   , "🐘"
--   , "🐙"
--   , "🐚"
--   , "🐛"
--   , "🐜"
--   , "🐝"
--   , "🐞"
--   , "🐟"
--   , "🐠"
--   , "🐡"
--   , "🐢"
--   , "🐣"
--   , "🐤"
--   , "🐥"
--   , "🐦"
--   , "🐧"
--   , "🐨"
--   , "🐩"
--   , "🐫"
--   , "🐬"
--   , "🐭"
--   , "🐮"
--   , "🐯"
--   , "🐰"
--   , "🐱"
--   , "🐲"
--   , "🐳"
--   , "🐴"
--   , "🐵"
--   , "🐶"
--   , "🐷"
--   , "🐸"
--   , "🐹"
--   , "🐺"
--   , "🐻"
--   , "🐼"
--   , "🐽"
--   , "🐾"
--   , "👀"
--   , "👂"
--   , "👃"
--   , "👄"
--   , "👅"
--   , "👆"
--   , "👇"
--   , "👈"
--   , "👉"
--   , "👊"
--   , "👋"
--   , "👌"
--   , "👍"
--   , "👎"
--   , "👏"
--   , "👐"
--   , "👑"
--   , "👒"
--   , "👓"
--   , "👔"
--   , "👕"
--   , "👖"
--   , "👗"
--   , "👘"
--   , "👙"
--   , "👚"
--   , "👛"
--   , "👜"
--   , "👝"
--   , "👞"
--   , "👟"
--   , "👠"
--   , "👡"
--   , "👢"
--   , "👣"
--   , "👤"
--   , "👦"
--   , "👧"
--   , "👨"
--   , "👩"
--   , "👪"
--   , "👫"
--   , "👮"
--   , "👯"
--   , "👰"
--   , "👱"
--   , "👲"
--   , "👳"
--   , "👴"
--   , "👵"
--   , "👶"
--   , "👷"
--   , "👸"
--   , "👹"
--   , "👺"
--   , "👻"
--   , "👼"
--   , "👽"
--   , "👾"
--   , "👿"
--   , "💀"
--   , "💁"
--   , "💂"
--   , "💃"
--   , "💄"
--   , "💅"
--   , "💆"
--   , "💇"
--   , "💈"
--   , "💉"
--   , "💊"
--   , "💋"
--   , "💌"
--   , "💍"
--   , "💎"
--   , "💏"
--   , "💐"
--   , "💑"
--   , "💒"
--   , "💓"
--   , "💔"
--   , "💕"
--   , "💖"
--   , "💗"
--   , "💘"
--   , "💙"
--   , "💚"
--   , "💛"
--   , "💜"
--   , "💝"
--   , "💞"
--   , "💟"
--   , "💠"
--   , "💡"
--   , "💢"
--   , "💣"
--   , "💤"
--   , "💥"
--   , "💦"
--   , "💧"
--   , "💨"
--   , "💩"
--   , "💪"
--   , "💫"
--   , "💬"
--   , "💮"
--   , "💯"
--   , "💰"
--   , "💱"
--   , "💲"
--   , "💳"
--   , "💴"
--   , "💵"
--   , "💸"
--   , "💹"
--   , "💺"
--   , "💻"
--   , "💼"
--   , "💽"
--   , "💾"
--   , "💿"
--   , "📀"
--   , "📁"
--   , "📂"
--   , "📃"
--   , "📄"
--   , "📅"
--   , "📆"
--   , "📇"
--   , "📈"
--   , "📉"
--   , "📊"
--   , "📋"
--   , "📌"
--   , "📍"
--   , "📎"
--   , "📏"
--   , "📐"
--   , "📑"
--   , "📒"
--   , "📓"
--   , "📔"
--   , "📕"
--   , "📖"
--   , "📗"
--   , "📘"
--   , "📙"
--   , "📚"
--   , "📛"
--   , "📜"
--   , "📝"
--   , "📞"
--   , "📟"
--   , "📠"
--   , "📡"
--   , "📢"
--   , "📣"
--   , "📤"
--   , "📥"
--   , "📦"
--   , "📧"
--   , "📨"
--   , "📩"
--   , "📪"
--   , "📫"
--   , "📮"
--   , "📰"
--   , "📱"
--   , "📲"
--   , "📳"
--   , "📴"
--   , "📶"
--   , "📷"
--   , "📹"
--   , "📺"
--   , "📻"
--   , "📼"
--   , "🔃"
--   , "🔊"
--   , "🔋"
--   , "🔌"
--   , "🔍"
--   , "🔎"
--   , "🔏"
--   , "🔐"
--   , "🔑"
--   , "🔒"
--   , "🔓"
--   , "🔔"
--   , "🔖"
--   , "🔗"
--   , "🔘"
--   , "🔙"
--   , "🔚"
--   , "🔛"
--   , "🔜"
--   , "🔝"
--   , "🔞"
--   , "🔟"
--   , "🔠"
--   , "🔡"
--   , "🔢"
--   , "🔣"
--   , "🔤"
--   , "🔥"
--   , "🔦"
--   , "🔧"
--   , "🔨"
--   , "🔩"
--   , "🔪"
--   , "🔫"
--   , "🔮"
--   , "🔯"
--   , "🔰"
--   , "🔱"
--   , "🔲"
--   , "🔳"
--   , "🔴"
--   , "🔵"
--   , "🔶"
--   , "🔷"
--   , "🔸"
--   , "🔹"
--   , "🔺"
--   , "🔻"
--   , "🔼"
--   , "🔽"
--   , "🕐"
--   , "🕑"
--   , "🕒"
--   , "🕓"
--   , "🕔"
--   , "🕕"
--   , "🕖"
--   , "🕗"
--   , "🕘"
--   , "🕙"
--   , "🕚"
--   , "🕛"
--   , "🗻"
--   , "🗼"
--   , "🗽"
--   , "🗾"
--   , "🗿"
--   , "😁"
--   , "😂"
--   , "😃"
--   , "😄"
--   , "😅"
--   , "😆"
--   , "😇"
--   , "😈"
--   , "😉"
--   , "😊"
--   , "😋"
--   , "😌"
--   , "😍"
--   , "😎"
--   , "😏"
--   , "😐"
--   , "😒"
--   , "😓"
--   , "😔"
--   , "😖"
--   , "😘"
--   , "😚"
--   , "😜"
--   , "😝"
--   , "😞"
--   , "😠"
--   , "😡"
--   , "😢"
--   , "😣"
--   , "😤"
--   , "😥"
--   , "😨"
--   , "😩"
--   , "😪"
--   , "😫"
--   , "😭"
--   , "😰"
--   , "😱"
--   , "😲"
--   , "😳"
--   , "😵"
--   , "😶"
--   , "😷"
--   , "😸"
--   , "😹"
--   , "😺"
--   , "😻"
--   , "😼"
--   , "😽"
--   , "😾"
--   , "😿"
--   , "🙀"
--   , "🙅"
--   , "🙆"
--   , "🙇"
--   , "🙈"
--   , "🙉"
--   , "🙊"
--   , "🙋"
--   , "🙌"
--   , "🙍"
--   , "🙎"
--   , "🙏"
--   , "🚀"
--   , "🚃"
--   , "🚄"
--   , "🚅"
--   , "🚇"
--   , "🚉"
--   , "🚌"
--   , "🚏"
--   , "🚑"
--   , "🚒"
--   , "🚓"
--   , "🚕"
--   , "🚗"
--   , "🚙"
--   , "🚚"
--   , "🚢"
--   , "🚤"
--   , "🚥"
--   , "🚧"
--   , "🚨"
--   , "🚩"
--   , "🚪"
--   , "🚫"
--   , "🚬"
--   , "🚭"
--   , "🚲"
--   , "🚶"
--   , "🚹"
--   , "🚺"
--   , "🚻"
--   , "🚼"
--   , "🚽"
--   , "🚾"
--   , "🛀"
--   , "‼"
--   , "⁉"
--   , "™"
--   , "↔"
--   , "↕"
--   , "↖"
--   , "↗"
--   , "↘"
--   , "↙"
--   , "↩"
--   , "↪"
--   , "#⃣"
--   , "⌚"
--   , "⌛"
--   , "⏩"
--   , "⏪"
--   , "⏫"
--   , "⏬"
--   , "⏰"
--   , "⏳"
--   , "Ⓜ"
--   , "▪"
--   , "▫"
--   , "▶"
--   , "◀"
--   , "◻"
--   , "◼"
--   , "◽"
--   , "◾"
--   , "☀"
--   , "☁"
--   , "☎"
--   , "☑"
--   , "☔"
--   , "☕"
--   , "☝"
--   , "☺"
--   , "♈"
--   , "♉"
--   , "♊"
--   , "♋"
--   , "♌"
--   , "♍"
--   , "♎"
--   , "♏"
--   , "♐"
--   , "♑"
--   , "♒"
--   , "♓"
--   , "♠"
--   , "♣"
--   , "♥"
--   , "♦"
--   , "♨"
--   , "♻"
--   , "♿"
--   , "⚓"
--   , "⚠"
--   , "⚡"
--   , "⚪"
--   , "⚫"
--   , "⚽"
--   , "⚾"
--   , "⛄"
--   , "⛅"
--   , "⛎"
--   , "⛔"
--   , "⛪"
--   , "⛲"
--   , "⛳"
--   , "⛵"
--   , "⛺"
--   , "⛽"
--   , "✂"
--   , "✅"
--   , "✈"
--   , "✉"
--   , "✊"
--   , "✋"
--   , "✌"
--   , "✏"
--   , "✒"
--   , "✔"
--   , "✖"
--   , "✨"
--   , "✳"
--   , "✴"
--   , "❄"
--   , "❇"
--   , "❌"
--   , "❎"
--   , "❓"
--   , "❔"
--   , "❕"
--   , "❗"
--   , "❤"
--   , "➕"
--   , "➖"
--   , "➗"
--   , "➡"
--   , "➰"
--   , "➿"
--   , "⤴"
--   , "⤵"
--   , "⬅"
--   , "⬆"
--   , "⬇"
--   , "⬛"
--   , "⬜"
--   , "⭐"
--   , "⭕"
--   , "0⃣"
--   , "〰"
--   , "〽"
--   , "1⃣"
--   , "2⃣"
--   , "㊗"
--   , "㊙"
--   , "3⃣"
--   , "4⃣"
--   , "5⃣"
--   , "6⃣"
--   , "7⃣"
--   , "8⃣"
--   , "9⃣"
--   , "©"
--   , "®"
--   ]
